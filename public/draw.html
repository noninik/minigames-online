<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>–†–∏—Å—É–π –∏ –£–≥–∞–¥–∞–π ‚Äî MiniGames</title>
  <link rel="stylesheet" href="style.css">
  <script src="/socket.io/socket.io.js"></script>
  <style>
    .scoreboard {
      background: #1a1a2e;
      border: 1px solid #333;
      border-radius: 12px;
      padding: 12px 15px;
      margin: 10px 0;
      width: 100%;
      max-width: 600px;
    }
    .scoreboard h3 {
      color: #667eea;
      margin-bottom: 8px;
      font-size: 1em;
    }
    .sb-row {
      display: flex;
      justify-content: space-between;
      padding: 4px 0;
      color: #ccc;
      font-size: 0.9em;
    }
    .sb-row.drawer {
      color: #f39c12;
    }
    .sb-score {
      font-weight: bold;
      color: #2ecc71;
    }
    .word-overlay {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.85);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 100;
    }
    .word-overlay h2 {
      color: #2ecc71;
      font-size: 1.8em;
      margin-bottom: 10px;
    }
    .word-overlay p {
      color: #ccc;
      font-size: 1.1em;
    }
    .word-input-area {
      margin-top: 12px;
      text-align: center;
    }
    .round-badge {
      background: #667eea;
      color: #fff;
      padding: 3px 12px;
      border-radius: 15px;
      font-size: 0.85em;
      margin-right: 8px;
    }
  </style>
</head>
<body>
  <div class="container">
    <a href="/" class="back-link">‚Üê –ù–∞–∑–∞–¥</a>

    <!-- –õ–û–ë–ë–ò -->
    <div id="lobby" class="lobby">
      <h1>üé® –†–∏—Å—É–π –∏ –£–≥–∞–¥–∞–π</h1>
      <div>
        <button class="btn" onclick="createRoom()">–°–æ–∑–¥–∞—Ç—å –∫–æ–º–Ω–∞—Ç—É</button>
      </div>
      <div style="margin-top:15px">
        <input type="text" id="codeInput" placeholder="–ö–æ–¥" maxlength="6">
        <button class="btn btn-secondary" onclick="joinRoom()">–í–æ–π—Ç–∏</button>
      </div>
      <div id="roomInfo" class="hidden">
        <div class="room-code" id="roomCode"></div>
        <div class="info-bar">–ò–≥—Ä–æ–∫–æ–≤: <span id="playerCount">1</span>/4 ‚Äî –∂–¥—ë–º –ª—é–¥–µ–π</div>
        <button class="btn" id="startBtn" onclick="startFirst()">–ù–∞—á–∞—Ç—å –∏–≥—Ä—É</button>
      </div>
    </div>

    <!-- –ò–ì–†–ê -->
    <div id="gameScreen" class="game-area hidden">
      <div class="info-bar" id="hintBar">
        <span class="round-badge" id="roundBadge">–†–∞—É–Ω–¥ 1</span>
        <span id="hintText">–û–∂–∏–¥–∞–Ω–∏–µ...</span>
      </div>

      <canvas id="c"></canvas>

      <!-- –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã —Ä–∏—Å–æ–≤–∞–Ω–∏—è -->
      <div id="drawTools" class="hidden">
        <div class="color-picker">
          <div class="color-btn active" style="background:#fff" onclick="setClr('#fff',this)"></div>
          <div class="color-btn" style="background:#e74c3c" onclick="setClr('#e74c3c',this)"></div>
          <div class="color-btn" style="background:#3498db" onclick="setClr('#3498db',this)"></div>
          <div class="color-btn" style="background:#2ecc71" onclick="setClr('#2ecc71',this)"></div>
          <div class="color-btn" style="background:#f39c12" onclick="setClr('#f39c12',this)"></div>
          <div class="color-btn" style="background:#9b59b6" onclick="setClr('#9b59b6',this)"></div>
          <div class="color-btn" style="background:#111" onclick="setClr('#111',this)"></div>
        </div>
        <div>
          <button class="btn btn-secondary" onclick="clearC()" style="padding:8px 15px;font-size:0.85em">–û—á–∏—Å—Ç–∏—Ç—å</button>
          <button class="btn btn-secondary" onclick="sz=2" style="padding:8px 12px;font-size:0.85em">–¢–æ–Ω–∫–∞—è</button>
          <button class="btn btn-secondary" onclick="sz=5" style="padding:8px 12px;font-size:0.85em">–°—Ä–µ–¥–Ω—è—è</button>
          <button class="btn btn-secondary" onclick="sz=10" style="padding:8px 12px;font-size:0.85em">–¢–æ–ª—Å—Ç–∞—è</button>
        </div>
        <div class="word-input-area" id="wordInputArea">
          <input type="text" id="wordInput" placeholder="–í–≤–µ–¥–∏ —Å–ª–æ–≤–æ">
          <button class="btn" onclick="setWord()">–†–∏—Å–æ–≤–∞—Ç—å!</button>
        </div>
      </div>

      <!-- –¢–∞–±–ª–æ -->
      <div class="scoreboard" id="scoreboard">
        <h3>üìä –°—á—ë—Ç</h3>
        <div id="scoreRows"></div>
      </div>

      <!-- –ß–∞—Ç -->
      <div id="chat">
        <div id="chat-messages"></div>
        <div id="guessArea">
          <input type="text" id="guessInput" placeholder="–¢–≤–æ–π –æ—Ç–≤–µ—Ç..."
            onkeydown="if(event.key==='Enter')sendGuess()">
          <button class="btn" onclick="sendGuess()">‚Üí</button>
        </div>
      </div>
    </div>

    <!-- –û–≤–µ—Ä–ª–µ–π —É–≥–∞–¥–∞–Ω–æ -->
    <div id="overlay" class="word-overlay hidden">
      <h2 id="overlayTitle">‚úÖ –£–≥–∞–¥–∞–Ω–æ!</h2>
      <p id="overlayWord"></p>
      <p id="overlayNext" style="margin-top:15px;color:#888"></p>
    </div>
  </div>

<script>
const socket = io();
const canvas = document.getElementById('c');
const ctx = canvas.getContext('2d');

let isDrawer = false;
let drawing = false;
let color = '#fff';
let lastPos = null;
let sz = 3;
let cW, cH, scaleX = 1, scaleY = 1;
let myId = null;
let players = [];
let currentDrawerIndex = 0;

// –ü–æ–ª—É—á–∞–µ–º —Å–≤–æ–π ID
socket.on('connect', () => { myId = socket.id; });

function resize() {
  cW 
